import{g as D,i as R}from"./chunk-R42GCTHV.js";import{a as U}from"./chunk-IA5P3YQN.js";import{a as k}from"./chunk-ZUGU5IHP.js";import{b as C}from"./chunk-LPC3JP5D.js";import{a as L,b as A}from"./chunk-NXH6K27G.js";import{a as $}from"./chunk-DE4HFEOV.js";import"./chunk-HP25GDQW.js";import{a as E}from"./chunk-2OZ4JKVY.js";import{b as S}from"./chunk-IRKXFVRU.js";import{a as m,e as g}from"./chunk-SDY2POXP.js";var e=g(E());var u=g(E());var b=g(S()),M=g(U());window.pdfStateID=1e4;var P=m(({children:n,header:r,loading:p,footer:i,landscape:t,margin:o})=>{let a=(0,b.useRef)({id:`pdf-${window.pdfStateID++}`,ready:!1,contentEl:null,renderTimeout:0,pdfURL:""}).current,s=k();return(0,b.useEffect)(()=>{if(document.getElementById(a.id))a.contentEl=document.getElementById(a.id);else{let f=document.createElement("div");f.id=a.id,f.style.display="none",a.contentEl=document.body.appendChild(f)}s()},[]),(0,b.useEffect)(()=>{a.renderTimeout&&clearTimeout(a.renderTimeout),a.renderTimeout=setTimeout(async()=>{await L(()=>a.contentEl?.querySelector(".pdf-content")?.innerHTML);let f=a.id.substr(4),l=a.contentEl?.querySelector(".pdf-footer"),c=a.contentEl?.querySelector(".pdf-header"),d=m(async h=>{if(h){let y=[];h.querySelectorAll("img").forEach(v=>{y.push(new Promise(O=>{v.crossOrigin="Anonymous",v.onload=function(){if(v.src.indexOf("data:image/png;base64")<0){var _=document.createElement("CANVAS"),T=_.getContext("2d");_.height=v.naturalHeight,_.width=v.naturalWidth,T&&(T.drawImage(v,0,0),v.src=_.toDataURL(),O())}}}))}),await Promise.all(y)}},"processBase64");c&&await d(c),l&&await d(l);let w=a.contentEl?.querySelector(".pdf-content")?.innerHTML;await api(`/__pdf/gen/${f}`,{html:`
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <link rel="stylesheet" href="/index.css">
            <title>Document</title>
        </head>
        <body>
        ${w}
            
        </body>
        </html>`,header:c?.innerHTML,footer:l?.innerHTML,landscape:t,margin:o}),a.pdfURL=`/__pdf/dl/${f}?`+new Date().getTime(),s()},100)},[n]),(0,u.jsx)("div",{className:"flex flex-1 relative"},(!a.pdfURL||!!p)&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center"},(0,u.jsx)(C,null)),!p&&(0,u.jsx)(b.default.Fragment,null,a.pdfURL&&(0,u.jsx)("div",{className:"flex-1 w-full h-full flex"},(0,u.jsx)("embed",{src:`${a.pdfURL}`,type:"application/pdf",className:"flex-1 bg-white"})),a.contentEl&&(0,M.createPortal)((0,u.jsx)(b.default.Fragment,null,(0,u.jsx)("div",{className:"pdf-header"},r),(0,u.jsx)("div",{className:"pdf-footer"},i),(0,u.jsx)("div",{className:"pdf-content"},n)),a.contentEl)))},"Pdf");var B=g(A());var q=m((n,r)=>new Promise(async p=>{if(typeof n=="function"){let i=null;if(r&&(i=setTimeout(p,r)),await n()){clearTimeout(i),p();return}let t=0,o=setInterval(async()=>{await n()&&(i&&clearTimeout(i),clearInterval(o),p()),t>100&&clearInterval(o)},100)}else typeof n=="number"&&setTimeout(()=>{p()},n)}),"waitUntil"),F=m(n=>n[0].toLowerCase()+n.slice(1,n.length).replace(/[A-Z]/g,r=>`_${r.toLowerCase()}`),"toSnake"),x=Symbol("isProxy"),V=m(n=>new Proxy({},{get(p,i){let t=window,o="";!t.is_dev&&t.hostname&&(o=`${t.hostname}`);let N=m(async a=>{let s=`${o}/__data/${F(a.action)}`;a.table&&(s+=`...${a.table}`);let f={method:"POST",headers:{Accept:"application/json","Content-Type":"text/plain"},body:JSON.stringify(a)};return await(await fetch(s,f)).json()},"post");return i==="query"?async a=>{if(Array.isArray(a))return[];t.global=t,t.sodium||(t.sodium=(await import("./sodium-universal-UUKI3KAR.js")).default),t.Buffer||(t.Buffer=(await t.loadExt("dev/buffer.js")).buffer.Buffer),typeof t.secret=="object"&&t.secret.data&&(t.secret=t.secret.data);var s=t.Buffer.alloc(t.sodium.crypto_secretbox_NONCEBYTES),f=t.Buffer.from(t.secret),l=t.Buffer.from(a),c=t.Buffer.alloc(l.length+t.sodium.crypto_secretbox_MACBYTES);t.sodium.randombytes_buf(s),t.sodium.crypto_secretbox_easy(c,l,s,f);let d=`${o}/__data/query`,w={method:"POST",headers:{Accept:"application/json","Content-Type":"text/plain","x-nonce":s.toString("hex")},body:c};return await(await fetch(d,w)).json()}:new Proxy({},{get(a,s){return s===x?!0:async function(...f){let l=window,c=`${n}.${i.toString()}`;if(s==="definition"){if(l.tableDefinitions||(l.tableDefinitions={}),!window.is_dev&&localStorage[`dbdef-${i.toString()}`]&&(l.tableDefinitions[c]=JSON.parse(localStorage[`dbdef-${i.toString()}`])),l.tableDefinitions[c])return await q(()=>l.tableDefinitions[c]!=="loading"),l.tableDefinitions[c];l.tableDefinitions[c]="loading"}let d=await N({table:i,db:n,action:s,params:f});if(d&&d.status==="failed"&&d.reason)throw new Error(`db.${i.toString()}.${s.toString()}() ${d.reason}`);if(s==="definition"){for(let[h,y]of Object.entries(d.columns))y.type=y.type.toLowerCase();let w=(0,B.default)(d.columns,{pk:!0});d.pk=w.name,l.tableDefinitions[c]=d,localStorage[`dbdef-${i.toString()}`]=JSON.stringify(d)}return d}}})}}),"prepareDBClient");var H=V("main");var I=g(S());var J=m(({csrId:n})=>{let r=R(()=>({csr:{},loading:!0}));(0,I.useEffect)(()=>{p()},[]);let p=m(async()=>{let t=await H.t_csr.findFirst({select:{no_kegiatan:!0,tgl_kegiatan:!0,nama_project_csr:!0,lokasi:!0,jumlah_orang:!0,deskripsi_singkat:!0,m_pillar:{select:{name:!0}},m_supplier:{select:{nama_supplier:!0}},m_instansi_penerima:{select:{instansi_penerima:!0}},t_csr_detail_bantuan:{select:{harga_nett:!0,bantuan:!0,merek:!0,jenis:!0,jumlah:!0}}},where:{id:n}});runInAction(()=>{r.csr=t,r.loading=!1})},"loadCsr"),i=[{label:"Nomor Kegiatan CSR",value:": "+r.csr?.no_kegiatan},{label:"Tanggal-Bulan-Tahun",value:": "+globalVar.formatDate(r.csr?.tgl_kegiatan)},{label:"Pilar CSR",value:": "+r.csr?.m_pillar?.name},{label:"Nama Project CSR",value:": "+r.csr?.nama_project_csr},{label:"Lokasi",value:": "+r.csr?.lokasi},{label:"Supply Dari",value:": "+r.csr?.m_supplier?.nama_supplier}];return(0,e.jsx)("div",{className:"h-full",css:e.css`
        & div {
          height: 100%;
        }
      `},(0,e.jsx)(P,{loading:r.loading},(0,e.jsx)("div",{className:"mx-4"},i.map((t,o)=>(0,e.jsx)("div",{key:o,className:"flex justify-between mt-4 text-sm"},(0,e.jsx)("div",{className:"font-semibold"},t.label),(0,e.jsx)("div",{className:"text-left w-2/3"},t.value))),(0,e.jsx)("div",{className:"border-t border-b my-2 pb-2 text-sm"},(0,e.jsx)("div",{className:"flex mt-4 justify-between"},(0,e.jsx)("div",{className:"font-semibold"},"Instansi Penerima"),(0,e.jsx)("div",{className:"text-left w-2/3"},": ",r.csr?.m_instansi_penerima?.instansi_penerima)),(0,e.jsx)("div",{className:"flex mt-4  justify-between"},(0,e.jsx)("div",{className:"font-semibold"},"Penerima Manfaat"),(0,e.jsx)("div",{className:"text-left w-2/3"},": ",globalVar.numberFormat(r.csr?.jumlah_orang)," Orang"))),(0,e.jsx)("div",{className:"font-semibold py-3"},"Bantuan CSR"),(0,e.jsx)("table",{className:"w-full border text-sm"},(0,e.jsx)("thead",null,(0,e.jsx)("tr",{className:"text-left"},(0,e.jsx)("th",{className:"p-3"},"Jenis"),(0,e.jsx)("th",null,"Merek"),(0,e.jsx)("th",null,"Keterangan"),(0,e.jsx)("th",null,"Biaya"),(0,e.jsx)("th",null,"Jumlah"))),(0,e.jsx)("tbody",null,r.csr?.t_csr_detail_bantuan?.map((t,o)=>(0,e.jsx)("tr",{key:o,className:"border-t"},(0,e.jsx)("td",{className:"p-3"},t.bantuan),(0,e.jsx)("td",null,t.merek),(0,e.jsx)("td",null,t.jenis),(0,e.jsx)("td",null,"Rp ",globalVar.currencyFormat(t.harga_nett)),(0,e.jsx)("td",null,t.jumlah))))),(0,e.jsx)("div",{className:"font-semibold py-3"},"Total Bantuan"),(0,e.jsx)("div",{className:"border-t border-b my-2 pb-2 text-sm"},(0,e.jsx)("div",{className:"flex justify-between mt-4"},(0,e.jsx)("div",{className:"font-semibold"},"Biaya"),(0,e.jsx)("div",{className:"text-left w-2/3"},": Rp"," ",globalVar.currencyFormat(r.csr?.t_csr_detail_bantuan?.reduce((t,o)=>t+o.harga_nett,0)))),(0,e.jsx)("div",{className:"flex justify-between mt-4"},(0,e.jsx)("div",{className:"font-semibold"},"Cat"),(0,e.jsx)("div",{className:"text-left w-2/3"},":"," ",globalVar.numberFormat(r.csr?.t_csr_detail_bantuan?.reduce((t,o)=>t+o.jumlah,0))," ","Kg"))),(0,e.jsx)("div",{className:"font-semibold py-3"},"Deskripsi Singkat"),(0,e.jsx)("div",{className:"text-sm"},(0,e.jsx)($,null,r.csr?.deskripsi_singkat)))))},"PDFReader"),te=D(J);export{te as default};
//# sourceMappingURL=pdf-reader-JFTBAWU5.js.map
